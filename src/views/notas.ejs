<!DOCTYPE html> 
<html lang="es">
<head>
    <%- include('partials/head.ejs') %>
    <title>Notas</title>
    <link rel="stylesheet" href="/css/notas.css" />
</head>
<body>
    <%- include('partials/header.ejs') %>
    <%- include('partials/sidebar.ejs') %>

    <main class="content-container">
        <table>
            <tbody>
                <tr>
                    <td colspan="26">COLEGIO PROVINCIAL DR. ERNESTO GUEVARA</td>
                </tr>
                <tr>
                    <td colspan="3">Apellido y nombre:</td>
                    <td colspan="3"><%= usuario.nombre %></td>
                    <td colspan="3">Curso:</td>
                    <td colspan="3"><%= usuario.curso.nombre_curso %></td>
                    <td colspan="2">Año:</td>
                    <td colspan="2">2024</td>
                </tr>
                <tr>
                    <td colspan="2">Ciclo Superior de la ESO</td>
                    <% 
                    const numMaterias = usuario.curso && usuario.curso.materias ? usuario.curso.materias.length : 0;
                    const espaciosRestantes = 12 - numMaterias;
                    if (usuario.curso && usuario.curso.materias) { 
                    %>
                        <% usuario.curso.materias.forEach(materia => { %>
                            <td><%= materia.nombre_materia %></td> <!-- Muestra el nombre de la materia -->
                        <% }); %>
                        <% for (let i = 0; i < espaciosRestantes; i++) { %>
                            <td colspan="2">-</td> <!-- Espacios vacíos -->
                        <% } %>
                    <% } else { %>
                        <% for (let i = 0; i < 12; i++) { %>
                            <td colspan="2">-</td> <!-- Cuando no hay materias asignadas -->
                        <% } %>
                    <% } %>
                </tr>
                
                <% const informes = ['1° informe', '2° informe']; %>
                <% ['Primer cuatrimestre', 'Segundo cuatrimestre'].forEach((cuatrimestre, cuatrimestreIndex) => { %>
                    <tr>
                        <td rowspan="3"><%= cuatrimestre %></td>
                        <% informes.forEach((informe) => { %>
                            <td><%= informe %></td>
                            <% if (usuario.curso && usuario.curso.materias) { %>
                                <% usuario.curso.materias.forEach(materia => { %>
                                    <td>
                                        <% 
                                        const nota = materia.notas.find(n => n.cuatrimestre === (cuatrimestreIndex + 1) && n.informe === (informes.indexOf(informe) + 1));
                                        if (nota) { 
                                        %>
                                            <%= nota.dataValues.nota %> <!-- Muestra la nota si existe -->
                                        <% } else { %>
                                            - <!-- Si no hay nota -->
                                        <% } %>
                                    </td>
                                <% }); %>
                                <% for (let i = 0; i < espaciosRestantes; i++) { %>
                                    <td colspan="2">-</td> <!-- Espacios vacíos para completar las 12 materias -->
                                <% } %>
                            <% } else { %>
                                <% for (let i = 0; i < 12   ; i++) { %>
                                    <td colspan="2">-</td> <!-- Cuando no hay materias asignadas -->
                                <% } %>
                            <% } %>
                        </tr>
                    <% }); %>
                    <tr>
                        <td>NOTA FINAL</td> 
                        <% if (usuario.curso && usuario.curso.materias) { %>
                            <% usuario.curso.materias.forEach(materia => { %>
                                <td>
                                    <% 
                                    const notaFinal = materia.notas.find(n => n.informe === 3 && n.cuatrimestre === (cuatrimestreIndex + 1));
                                    if (notaFinal) { 
                                    %>
                                        <%= notaFinal.dataValues.nota %> <!-- Muestra la nota final si existe -->
                                    <% } else { %>
                                        - <!-- Si no hay nota final -->
                                    <% } %>
                                </td>
                            <% }); %>
                            <% for (let i = 0; i < espaciosRestantes; i++) { %>
                                <td colspan="2">-</td> <!-- Espacios vacíos para completar las 12 materias -->
                            <% } %>
                        <% } else { %>
                            <% for (let i = 0; i < 12; i++) { %>
                                <td colspan="2">-</td> <!-- Cuando no hay materias asignadas -->
                            <% } %>
                        <% } %>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </main>
</body>
</html>
